# Dockerfile para desenvolvimento (com volumes mount)
FROM python:3.11-slim

RUN apt-get update && apt-get install -y \
    build-essential \
    wget \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /Verba

# Instala apenas dependências (código vem via volume)
COPY requirements-extensions.txt setup.py ./

# Instala Verba base
RUN pip install --no-cache-dir '.'

# Instala dependências das extensões
RUN pip install --no-cache-dir -r requirements-extensions.txt || true

# Instala dependências do Google Drive Reader (plugin patchable)
RUN pip install --no-cache-dir google-api-python-client google-auth-httplib2 google-auth-oauthlib || true

# Baixa modelos do spaCy e dados do NLTK para execução local
RUN python -m spacy download pt_core_news_sm || true
RUN python -m spacy download en_core_web_sm || pip install --no-cache-dir https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.7.0/en_core_web_sm-3.7.0-py3-none-any.whl
RUN python -c "import nltk; nltk.download('punkt', quiet=True)" || true

EXPOSE 8000

CMD ["verba", "start", "--port", "8000", "--host", "0.0.0.0"]

